<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIME MACHINE</title>
    <link rel="stylesheet" href="vcfmw.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #1a1a1a;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        header {
            flex-shrink: 0;
        }

        /* Iframe viewport */
        #viewport {
            flex: 1;
            width: 100%;
            border: none;
            background: #000;
            display: block;
        }

        /* VCR Control Bar */
        .vcr-bar {
            flex-shrink: 0;
            background: #2a2a2a;
            border-top: 2px outset #555;
            border-bottom: 2px inset #333;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.05);
            padding: 8px 12px 10px;
        }

        /* Scrubber track */
        .scrubber {
            position: relative;
            height: 18px;
            background: #111;
            border: 2px inset #333;
            margin-bottom: 8px;
            cursor: pointer;
            overflow: hidden;
        }

        .scrubber-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: #ffbf00;
            opacity: 0.7;
            transition: width 0.2s ease;
            pointer-events: none;
        }

        .scrubber-ticks {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .scrubber-tick {
            position: absolute;
            top: 0;
            width: 1px;
            height: 100%;
            background: rgba(255, 191, 0, 0.3);
        }

        /* Controls row */
        .controls-row {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* Transport buttons */
        .transport-buttons {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .transport-btn {
            background: #333;
            border: 2px outset #555;
            color: #ffbf00;
            font-size: 16px;
            padding: 6px 14px;
            cursor: pointer;
            font-family: "3270Medium", monospace, Courier;
            line-height: 1;
            min-width: 44px;
            text-align: center;
            user-select: none;
        }

        .transport-btn:hover {
            background: #444;
            border-color: #666;
        }

        .transport-btn:active {
            background: #222;
            border-style: inset;
        }

        .transport-btn.active {
            background: #553300;
            border-color: #ffbf00;
            color: #ffbf00;
            text-shadow: 0 0 6px #ffbf00;
        }

        /* LED readout */
        .led-readout {
            flex: 1;
            background: #111;
            border: 2px inset #333;
            padding: 5px 10px;
            min-height: 36px;
            display: flex;
            align-items: center;
            gap: 10px;
            overflow: hidden;
        }

        .led-date {
            color: #ff6600;
            text-shadow: 0 0 6px #ff6600;
            font-family: "3270Medium", monospace, Courier;
            font-size: 16px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .led-message {
            color: #ffbf00;
            text-shadow: 0 0 6px #ffbf00;
            font-family: "3270Medium", monospace, Courier;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        /* Counter */
        .counter {
            color: #ffbf00;
            font-family: "3270Medium", monospace, Courier;
            font-size: 16px;
            white-space: nowrap;
            flex-shrink: 0;
            background: #111;
            border: 2px inset #333;
            padding: 5px 10px;
            text-shadow: 0 0 4px #ffbf00;
        }

        /* Loading state */
        .led-readout.loading .led-message {
            animation: blink-loading 1s infinite;
        }

        @keyframes blink-loading {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        /* Mobile responsive */
        @media (max-width: 600px) {
            .controls-row {
                flex-wrap: wrap;
                gap: 6px;
            }

            .led-readout {
                order: -1;
                width: 100%;
                flex-basis: 100%;
            }

            .transport-btn {
                padding: 8px 12px;
                font-size: 14px;
                min-width: 40px;
            }

            .counter {
                font-size: 14px;
            }

            .led-date {
                font-size: 14px;
            }

            .led-message {
                font-size: 12px;
            }
        }
    </style>
</head>

<body>
<header>
    <a href="index.html"><img src="img/cheeze-bourger2.png" alt="Header Image"></a>
    <h1>TIME MACHINE</h1>
</header>

<iframe id="viewport"></iframe>

<div class="vcr-bar">
    <div class="scrubber" id="scrubber">
        <div class="scrubber-fill" id="scrubber-fill"></div>
        <div class="scrubber-ticks" id="scrubber-ticks"></div>
    </div>
    <div class="controls-row">
        <div class="transport-buttons">
            <button class="transport-btn" id="btn-rw" title="Rewind">&#9664;&#9664;</button>
            <button class="transport-btn" id="btn-play" title="Play">&#9654;</button>
            <button class="transport-btn" id="btn-stop" title="Stop">&#9632;</button>
            <button class="transport-btn" id="btn-ff" title="Fast Forward">&#9654;&#9654;</button>
        </div>
        <div class="led-readout loading" id="led-readout">
            <span class="led-date" id="led-date"></span>
            <span class="led-message" id="led-message">LOADING...</span>
        </div>
        <div class="counter" id="counter">-/-</div>
    </div>
</div>

<script>
    let manifest = [];
    let currentIndex = 0;
    let playInterval = null;

    const viewport = document.getElementById('viewport');
    const scrubber = document.getElementById('scrubber');
    const scrubberFill = document.getElementById('scrubber-fill');
    const scrubberTicks = document.getElementById('scrubber-ticks');
    const ledReadout = document.getElementById('led-readout');
    const ledDate = document.getElementById('led-date');
    const ledMessage = document.getElementById('led-message');
    const counter = document.getElementById('counter');
    const btnRw = document.getElementById('btn-rw');
    const btnPlay = document.getElementById('btn-play');
    const btnStop = document.getElementById('btn-stop');
    const btnFf = document.getElementById('btn-ff');

    function loadSnapshot(index) {
        if (index < 0 || index >= manifest.length) return;
        currentIndex = index;

        const snap = manifest[index];
        viewport.src = snap.path + 'index.html';

        // Update LED readout
        ledDate.textContent = snap.date;
        ledMessage.textContent = snap.message;

        // Update counter
        counter.textContent = (index + 1) + '/' + manifest.length;

        // Update scrubber fill
        const percent = manifest.length > 1
            ? (index / (manifest.length - 1)) * 100
            : 100;
        scrubberFill.style.width = percent + '%';
    }

    function buildTicks() {
        scrubberTicks.innerHTML = '';
        if (manifest.length <= 1) return;
        for (let i = 0; i < manifest.length; i++) {
            const tick = document.createElement('div');
            tick.className = 'scrubber-tick';
            tick.style.left = (i / (manifest.length - 1)) * 100 + '%';
            scrubberTicks.appendChild(tick);
        }
    }

    function startPlay() {
        if (playInterval) return;
        btnPlay.classList.add('active');
        playInterval = setInterval(function () {
            if (currentIndex < manifest.length - 1) {
                loadSnapshot(currentIndex + 1);
            } else {
                stopPlay();
            }
        }, 3500);
    }

    function stopPlay() {
        if (playInterval) {
            clearInterval(playInterval);
            playInterval = null;
        }
        btnPlay.classList.remove('active');
    }

    function togglePlay() {
        if (playInterval) {
            stopPlay();
        } else {
            startPlay();
        }
    }

    // Button handlers
    btnRw.addEventListener('click', function () {
        stopPlay();
        if (currentIndex > 0) {
            loadSnapshot(currentIndex - 1);
        }
    });

    btnPlay.addEventListener('click', togglePlay);

    btnStop.addEventListener('click', stopPlay);

    btnFf.addEventListener('click', function () {
        stopPlay();
        if (currentIndex < manifest.length - 1) {
            loadSnapshot(currentIndex + 1);
        }
    });

    // Scrubber click
    scrubber.addEventListener('click', function (e) {
        if (manifest.length === 0) return;
        const rect = scrubber.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const percent = x / rect.width;
        const index = Math.round(percent * (manifest.length - 1));
        stopPlay();
        loadSnapshot(Math.max(0, Math.min(manifest.length - 1, index)));
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function (e) {
        if (e.key === 'ArrowLeft') {
            e.preventDefault();
            stopPlay();
            if (currentIndex > 0) loadSnapshot(currentIndex - 1);
        } else if (e.key === 'ArrowRight') {
            e.preventDefault();
            stopPlay();
            if (currentIndex < manifest.length - 1) loadSnapshot(currentIndex + 1);
        } else if (e.key === ' ') {
            e.preventDefault();
            togglePlay();
        }
    });

    // Fetch manifest and initialize
    fetch('history/manifest.json')
        .then(function (response) {
            if (!response.ok) throw new Error('Failed to load manifest');
            return response.json();
        })
        .then(function (data) {
            manifest = data;
            ledReadout.classList.remove('loading');

            if (manifest.length === 0) {
                ledMessage.textContent = 'NO SNAPSHOTS FOUND';
                return;
            }

            buildTicks();
            loadSnapshot(0);
        })
        .catch(function (err) {
            ledReadout.classList.remove('loading');
            ledDate.textContent = '';
            ledMessage.textContent = 'ERROR: ' + err.message;
            console.error('Manifest load error:', err);
        });
</script>
</body>
</html>
