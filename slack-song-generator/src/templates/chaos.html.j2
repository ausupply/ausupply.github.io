<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SONG TITLE LIBRARY</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(45deg, #ffcccc, #ccffcc, #ccccff);
            overflow-x: hidden;
            position: relative;
            padding-bottom: 70px;
            transition: background 0.3s ease;
        }

        .header {
            text-align: center;
            padding: 20px;
            font-family: 'Comic Sans MS', cursive;
            font-size: 2rem;
            color: #ff00ff;
            text-shadow: 3px 3px 0 #00ffff, -3px -3px 0 #ffff00;
            position: relative;
            z-index: 9999;
        }

        .title {
            position: absolute;
            white-space: nowrap;
            cursor: grab;
            transition: transform 0.1s ease;
            user-select: none;
        }

        .title:active {
            cursor: grabbing;
        }

        .title.selected {
            outline: 3px dashed #ff00ff;
            outline-offset: 4px;
        }

        .title:hover {
            z-index: 10000 !important;
        }

        .media {
            position: absolute;
            pointer-events: none;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes rainbow {
            0% { color: #ff0000; }
            17% { color: #ff8800; }
            33% { color: #ffff00; }
            50% { color: #00ff00; }
            67% { color: #0088ff; }
            83% { color: #8800ff; }
            100% { color: #ff0000; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px) rotate(-1deg); }
            75% { transform: translateX(3px) rotate(1deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .anim-blink { animation: blink 1s infinite; }
        .anim-pulse { animation: pulse 1s infinite; }
        .anim-rainbow { animation: rainbow 3s linear infinite; }
        .anim-shake { animation: shake 0.3s infinite; }
        .anim-float { animation: float 2s ease-in-out infinite; }
        .anim-none { animation: none; }

        /* Toolbar */
        .toolbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to right, #ff00ff, #00ffff, #ffff00);
            border-top: 3px solid #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 20px;
            z-index: 99999;
            font-family: 'Comic Sans MS', cursive;
        }

        .toolbar-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .toolbar button {
            padding: 6px 12px;
            font-size: 13px;
            font-family: 'Comic Sans MS', cursive;
            border: 2px solid #000;
            border-radius: 4px;
            cursor: pointer;
            background: #fff;
            transition: all 0.1s;
        }

        .toolbar button:hover {
            transform: scale(1.05);
            background: #ffff00;
        }

        .toolbar button:active {
            transform: scale(0.95);
        }

        .toolbar button.active {
            background: #00ff00;
        }

        .toolbar select {
            padding: 6px;
            font-size: 13px;
            font-family: 'Comic Sans MS', cursive;
            border: 2px solid #000;
            border-radius: 4px;
            cursor: pointer;
        }

        .toolbar .divider {
            width: 2px;
            height: 24px;
            background: #000;
            margin: 0 4px;
        }

        .toolbar .label {
            font-size: 11px;
            font-weight: bold;
            color: #000;
            background: rgba(255,255,255,0.7);
            padding: 2px 6px;
            border-radius: 3px;
        }

        .color-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #000 !important;
            padding: 0 !important;
        }

        .bg-btn {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 2px solid #000 !important;
            padding: 0 !important;
        }

        .rotate-btn {
            font-size: 16px !important;
            padding: 4px 10px !important;
        }
    </style>
</head>
<body>
    <div class="header">
        â˜… SONG TITLE LIBRARY â˜…
    </div>

    {% for style in title_styles %}
    <div class="title{% if loop.index % 17 == 0 %} anim-blink{% endif %}"
         data-id="{{ loop.index }}"
         data-rotation="{{ style.rotation }}"
         style="
            left: {{ style.left }}%;
            top: {{ style.top }}%;
            transform: rotate({{ style.rotation }}deg);
            font-size: {{ style.font_size }}px;
            color: {{ style.color }};
            font-family: '{{ style.font_family }}', sans-serif;
            {% if style.text_shadow %}text-shadow: {{ style.text_shadow }};{% endif %}
            {% if style.border %}border: {{ style.border }}; padding: 5px;{% endif %}
            z-index: {{ style.z_index }};
         ">
        {{ style.text }}
    </div>
    {% endfor %}

    {% for media in media_styles %}
    <img class="media"
         src="{{ media.src }}"
         style="
            left: {{ media.left }}%;
            top: {{ media.top }}%;
            transform: rotate({{ media.rotation }}deg);
            width: {{ media.width }}px;
            z-index: {{ media.z_index }};
         "
         alt="">
    {% endfor %}

    <div class="toolbar">
        <div class="toolbar-row">
            <span class="label">TEXT</span>
            <button class="color-btn" style="background: #ff00ff" data-color="#ff00ff"></button>
            <button class="color-btn" style="background: #00ff00" data-color="#00ff00"></button>
            <button class="color-btn" style="background: #00ffff" data-color="#00ffff"></button>
            <button class="color-btn" style="background: #ffff00" data-color="#ffff00"></button>
            <button class="color-btn" style="background: #ff0000" data-color="#ff0000"></button>
            <button class="color-btn" style="background: #ff8800" data-color="#ff8800"></button>
            <button class="color-btn" style="background: #ffffff" data-color="#ffffff"></button>
            <button class="color-btn" style="background: #000000" data-color="#000000"></button>

            <div class="divider"></div>

            <span class="label">ROTATE</span>
            <button class="rotate-btn" id="rotateLeft">â†º</button>
            <button class="rotate-btn" id="rotateRight">â†»</button>

            <div class="divider"></div>

            <select id="animSelect">
                <option value="">Animation...</option>
                <option value="anim-none">None</option>
                <option value="anim-blink">Blink</option>
                <option value="anim-pulse">Pulse</option>
                <option value="anim-rainbow">Rainbow</option>
                <option value="anim-shake">Shake</option>
                <option value="anim-float">Float</option>
            </select>

            <div class="divider"></div>

            <span class="label">BG</span>
            <button class="bg-btn" style="background: linear-gradient(45deg, #ffcccc, #ccffcc, #ccccff)" data-bg="linear-gradient(45deg, #ffcccc, #ccffcc, #ccccff)"></button>
            <button class="bg-btn" style="background: #000000" data-bg="#000000"></button>
            <button class="bg-btn" style="background: #ffffff" data-bg="#ffffff"></button>
            <button class="bg-btn" style="background: #1a1a2e" data-bg="#1a1a2e"></button>
            <button class="bg-btn" style="background: linear-gradient(45deg, #ff00ff, #00ffff)" data-bg="linear-gradient(45deg, #ff00ff, #00ffff)"></button>
            <button class="bg-btn" style="background: linear-gradient(180deg, #000428, #004e92)" data-bg="linear-gradient(180deg, #000428, #004e92)"></button>
            <button class="bg-btn" style="background: linear-gradient(45deg, #232526, #414345)" data-bg="linear-gradient(45deg, #232526, #414345)"></button>
            <button class="bg-btn" style="background: #ff6b6b" data-bg="repeating-linear-gradient(45deg, #ff6b6b, #ff6b6b 10px, #feca57 10px, #feca57 20px)"></button>

            <div class="divider"></div>

            <button id="resetBtn">Reset</button>
            <button id="saveBtn">ðŸ’¾</button>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'songTitlePositions_v2';
        const BG_STORAGE_KEY = 'songTitleBackground';
        let selectedTitle = null;
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };

        // Load saved background
        function loadBackground() {
            const savedBg = localStorage.getItem(BG_STORAGE_KEY);
            if (savedBg) {
                document.body.style.background = savedBg;
            }
        }

        // Save background
        function saveBackground(bg) {
            localStorage.setItem(BG_STORAGE_KEY, bg);
        }

        // Load saved positions
        function loadPositions() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (!saved) return;

            try {
                const positions = JSON.parse(saved);
                document.querySelectorAll('.title').forEach(title => {
                    const id = title.dataset.id;
                    if (positions[id]) {
                        const p = positions[id];
                        if (p.left !== undefined) title.style.left = p.left;
                        if (p.top !== undefined) title.style.top = p.top;
                        if (p.rotation !== undefined) {
                            title.dataset.rotation = p.rotation;
                            title.style.transform = `rotate(${p.rotation}deg)`;
                        }
                        if (p.color !== undefined) title.style.color = p.color;
                        if (p.animation !== undefined) {
                            title.classList.remove('anim-blink', 'anim-pulse', 'anim-rainbow', 'anim-shake', 'anim-float', 'anim-none');
                            if (p.animation) title.classList.add(p.animation);
                        }
                    }
                });
            } catch (e) {
                console.error('Failed to load positions:', e);
            }
        }

        // Save positions
        function savePositions() {
            const positions = {};
            document.querySelectorAll('.title').forEach(title => {
                const id = title.dataset.id;
                const animClass = Array.from(title.classList).find(c => c.startsWith('anim-'));
                positions[id] = {
                    left: title.style.left,
                    top: title.style.top,
                    rotation: parseInt(title.dataset.rotation) || 0,
                    color: title.style.color,
                    animation: animClass || ''
                };
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(positions));
        }

        // Rotate selected title
        function rotateSelected(degrees) {
            if (!selectedTitle) return;
            let rotation = parseInt(selectedTitle.dataset.rotation) || 0;
            rotation += degrees;
            selectedTitle.dataset.rotation = rotation;
            selectedTitle.style.transform = `rotate(${rotation}deg)`;
            autoSave();
        }

        // Select title
        function selectTitle(title) {
            if (selectedTitle) {
                selectedTitle.classList.remove('selected');
            }
            selectedTitle = title;
            if (title) {
                title.classList.add('selected');
            }
        }

        // Title click/drag handlers
        document.querySelectorAll('.title').forEach(title => {
            title.addEventListener('mousedown', (e) => {
                e.preventDefault();
                selectTitle(title);
                isDragging = true;
                const rect = title.getBoundingClientRect();
                dragOffset.x = e.clientX - rect.left;
                dragOffset.y = e.clientY - rect.top;
                title.style.zIndex = 10001;
            });

            // Scroll to rotate
            title.addEventListener('wheel', (e) => {
                e.preventDefault();
                selectTitle(title);
                let rotation = parseInt(title.dataset.rotation) || 0;
                rotation += e.deltaY > 0 ? 5 : -5;
                title.dataset.rotation = rotation;
                title.style.transform = `rotate(${rotation}deg)`;
            });
        });

        // Mouse move for dragging
        document.addEventListener('mousemove', (e) => {
            if (!isDragging || !selectedTitle) return;

            const x = e.clientX - dragOffset.x;
            const y = e.clientY - dragOffset.y;

            // Convert to percentage
            const leftPercent = (x / window.innerWidth) * 100;
            const topPercent = (y / window.innerHeight) * 100;

            selectedTitle.style.left = `${leftPercent}%`;
            selectedTitle.style.top = `${topPercent}%`;
        });

        // Mouse up
        document.addEventListener('mouseup', () => {
            isDragging = false;
        });

        // Click elsewhere to deselect
        document.addEventListener('click', (e) => {
            if (!e.target.classList.contains('title') &&
                !e.target.closest('.toolbar')) {
                selectTitle(null);
            }
        });

        // Color buttons
        document.querySelectorAll('.color-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (selectedTitle) {
                    selectedTitle.style.color = btn.dataset.color;
                    autoSave();
                }
            });
        });

        // Background buttons
        document.querySelectorAll('.bg-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const bg = btn.dataset.bg;
                document.body.style.background = bg;
                saveBackground(bg);
            });
        });

        // Rotate buttons
        document.getElementById('rotateLeft').addEventListener('click', () => rotateSelected(-15));
        document.getElementById('rotateRight').addEventListener('click', () => rotateSelected(15));

        // Animation select
        document.getElementById('animSelect').addEventListener('change', (e) => {
            if (selectedTitle && e.target.value) {
                selectedTitle.classList.remove('anim-blink', 'anim-pulse', 'anim-rainbow', 'anim-shake', 'anim-float', 'anim-none');
                selectedTitle.classList.add(e.target.value);
                e.target.value = '';
                autoSave();
            }
        });

        // Reset button
        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm('Reset all titles and background to original?')) {
                localStorage.removeItem(STORAGE_KEY);
                localStorage.removeItem(BG_STORAGE_KEY);
                location.reload();
            }
        });

        // Save button
        document.getElementById('saveBtn').addEventListener('click', () => {
            savePositions();
            alert('Saved!');
        });

        // Auto-save on changes
        let saveTimeout;
        function autoSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(savePositions, 1000);
        }

        document.addEventListener('mouseup', autoSave);
        document.querySelectorAll('.title').forEach(t => t.addEventListener('wheel', autoSave));

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (!selectedTitle) return;
            if (e.key === 'ArrowLeft' || e.key === '[') {
                e.preventDefault();
                rotateSelected(-5);
            } else if (e.key === 'ArrowRight' || e.key === ']') {
                e.preventDefault();
                rotateSelected(5);
            }
        });

        // Load on start
        loadBackground();
        loadPositions();
    </script>
</body>
</html>
